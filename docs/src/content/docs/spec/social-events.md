---
title: Social Events
---

# Social Events

## Purpose

Social events capture teasing, gossip, and lightweight observations about other naras.
They provide the raw facts used to derive clout and to power the UI timeline.

## Conceptual Model

Entities:
- **`SocialEventPayload`**: The syncable social payload embedded in a `SyncEvent`.
- **`SocialEvent`**: Legacy standalone struct (deprecated but still used in some UI paths).
- **`TeaseState`**: Tracks cooldowns per actor-target pair to prevent spam.
- **`TeaseMessage`**: Deterministic message template derived from reason + target name.

Key invariants:
- Social events are immutable and stored in the `SyncLedger` with `svc: social`.
- They can be filtered per observer based on personality (e.g., chill naras ignore petty gossip).
- Tease delivery is best-effort: direct DM first, falling back to gossip/MQTT.
- System observations (uptime, journeys) are often encoded as social events with `type: "observation"`.

## External Behavior

- **Triggering**: Teasing is generated by local heuristics (restarts, comebacks, trend changes, random).
- **Receipt**: On arrival, events are verified (signature check) and potentially filtered (personality check) before ledger ingestion.
- **Consumption**: The UI consumes these events via SSE (`/events`) and REST (`/social/recent`).

## Interfaces

### MQTT Topics
- `nara/plaza/social`: Broadcasts `SyncEvent` with `svc="social"`.

### HTTP Endpoints
- `GET /events`: SSE stream of UI-formatted events (social, presence, ping).
- `GET /social/recent`: Recent social events (legacy format).
- `GET /social/teases`: Tease counts per actor.
- `POST /dm`: Mesh endpoint for direct message delivery (signed `SyncEvent`).

### Data Structures

**`SocialEventPayload`** (JSON inside SyncEvent):
```json
{
  "type": "tease | observed | gossip | observation | service",
  "actor": "nara-name",
  "target": "target-name",
  "reason": "reason-string",
  "witness": "witness-name"
}
```

## Event Types & Schemas

Service: `social`.

### Reasons
- **Tease**: `high-restarts`, `comeback`, `trend-abandon`, `random`, `nice-number`.
- **Observation**: `online`, `offline`, `journey-pass`, `journey-complete`, `journey-timeout`.
- **Service**: `stash-stored`.

### Types
- `tease`: Direct interaction.
- `observed`: Third-party observation of behavior.
- `gossip`: Retold information.
- `observation`: System-level state change (e.g. online/offline).
- `service`: Helpful action (e.g. stash).

## Algorithms

### Tease Gating & Selection
- **`ShouldTeaseForRestarts`**: Rate > 2/day (adjusted by personality).
- **`ShouldTeaseForNiceNumber`**: If restart count is "nice" (42, 69, 100, etc.), roll a deterministic die seeded by the count.
- **`ShouldTeaseForComeback`**: If `MISSING` -> `ONLINE` and `Sociability > 40`.
- **`ShouldTeaseForTrendAbandon`**: If leaving popular trend and `Agreeableness <= 70`.
- **`ShouldRandomTease`**: Deterministic hash of (soul + target + timestamp); base prob ~1%, adjusted by sociability/chill.

### Anti-Pile-On & Cooldown
- **Delay**: `TeaseWithDelay` waits 0-5s and aborts if a duplicate tease appears in that window.
- **Cooldown**: `TeaseState` enforces 5-minute silence per actor->target pair.

### Personality Filtering
`socialEventIsMeaningful` filters incoming events:
- **High Chill**: Ignores `random` teases and routine `online`/`offline` observations.
- **High Sociability**: Keeps more social interactions.
- **High Agreeableness**: May ignore conflict-heavy teases.

## Failure Modes

- **Signature Failure**: Unsigned or invalid DMs are rejected.
- **Delivery Failure**: If DM fails, the event is still gossiped/broadcast, ensuring eventual consistency.
- **Ledger Cap**: Old social events are pruned (priority 2), but critical history remains.

## Security / Trust Model

- **Authentication**: All events are signed. DMs require valid signatures matching known public keys.
- **No Global Truth**: Authenticity is local; you trust the signature, but the *content* (e.g. "X is offline") is just the emitter's opinion.

## Test Oracle

- **Triggers**: Tease logic fires deterministically based on inputs. (`teasing_test.go`)
- **Cooldown**: `TeaseState` blocks frequent teases. (`teasing_test.go`)
- **Filtering**: Personality settings correctly drop/keep events. (`sync_test.go`)
- **DM**: Direct messages verify signatures. (`http_test.go`)

## Open Questions / TODO

- **Legacy Struct**: `SocialEvent` struct is still used in `social.go` logic but should eventually be fully replaced by `SyncEvent` + `SocialEventPayload`.
