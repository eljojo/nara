---
title: Utilities
description: API reference for the utilities package
---

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# utilities

```go
import "github.com/eljojo/nara/utilities"
```

## Index

- [Variables](<#variables>)
- [type Correlator](<#Correlator>)
  - [func NewCorrelator\[Resp any\]\(timeout time.Duration\) \*Correlator\[Resp\]](<#NewCorrelator>)
  - [func \(c \*Correlator\[Resp\]\) Receive\(requestID string, resp Resp\) bool](<#Correlator[Resp].Receive>)
  - [func \(c \*Correlator\[Resp\]\) Send\(rt runtime.RuntimeInterface, msg \*runtime.Message\) \<\-chan Result\[Resp\]](<#Correlator[Resp].Send>)
- [type Encryptor](<#Encryptor>)
  - [func NewEncryptor\(seed \[\]byte\) \*Encryptor](<#NewEncryptor>)
  - [func \(e \*Encryptor\) Open\(nonce, ciphertext \[\]byte\) \(\[\]byte, error\)](<#Encryptor.Open>)
  - [func \(e \*Encryptor\) Seal\(plaintext \[\]byte\) \(nonce, ciphertext \[\]byte, err error\)](<#Encryptor.Seal>)
- [type Result](<#Result>)


## Variables

<a name="ErrTimeout"></a>ErrTimeout is returned when a request times out.

```go
var ErrTimeout = errors.New("request timed out")
```

<a name="Correlator"></a>
## type [Correlator](<https://github.com/eljojo/nara/blob/main/utilities/correlator.go#L27-L31>)

Correlator tracks pending requests and matches responses.

This is a generic utility for request/response patterns. Services that need request/response semantics \(like stash\) can use this.

Example:

```
type StashService struct {
    storeReqs *utilities.Correlator[messages.StashStoreAck]
}

func (s *StashService) StoreWith(confidant string, data []byte) error {
    msg := &runtime.Message{Kind: "stash:store", ...}
    result := <-s.storeReqs.Send(s.rt, msg)
    return result.Err
}
```

```go
type Correlator[Resp any] struct {
    // contains filtered or unexported fields
}
```

<a name="NewCorrelator"></a>
### func [NewCorrelator](<https://github.com/eljojo/nara/blob/main/utilities/correlator.go#L49>)

```go
func NewCorrelator[Resp any](timeout time.Duration) *Correlator[Resp]
```

NewCorrelator creates a correlator with the given timeout.

<a name="Correlator[Resp].Receive"></a>
### func \(\*Correlator\[Resp\]\) [Receive](<https://github.com/eljojo/nara/blob/main/utilities/correlator.go#L96>)

```go
func (c *Correlator[Resp]) Receive(requestID string, resp Resp) bool
```

Receive is called when a response arrives \- matches it to pending request.

Returns true if the response matched a pending request, false otherwise. Services call this from their response handlers.

<a name="Correlator[Resp].Send"></a>
### func \(\*Correlator\[Resp\]\) [Send](<https://github.com/eljojo/nara/blob/main/utilities/correlator.go#L62>)

```go
func (c *Correlator[Resp]) Send(rt runtime.RuntimeInterface, msg *runtime.Message) <-chan Result[Resp]
```

Send emits a request and returns a channel for the response.

The message is emitted via runtime.Emit\(\), and a channel is returned that will receive either the response or a timeout error.

<a name="Encryptor"></a>
## type [Encryptor](<https://github.com/eljojo/nara/blob/main/utilities/encryptor.go#L21-L23>)

Encryptor provides self\-encryption using XChaCha20\-Poly1305.

Self\-encryption means encrypting data that only the owner can decrypt. The encryption key is derived deterministically from a seed, so the same seed always produces the same encryption key.

This is used by stash to encrypt data before storing it with confidants. Only the owner can decrypt because only the owner has the seed.

```go
type Encryptor struct {
    // contains filtered or unexported fields
}
```

<a name="NewEncryptor"></a>
### func [NewEncryptor](<https://github.com/eljojo/nara/blob/main/utilities/encryptor.go#L29>)

```go
func NewEncryptor(seed []byte) *Encryptor
```

NewEncryptor creates an encryptor from a 32\-byte seed.

The seed is typically the Ed25519 private key seed. It's deterministically expanded into a symmetric encryption key using HKDF with domain separation.

<a name="Encryptor.Open"></a>
### func \(\*Encryptor\) [Open](<https://github.com/eljojo/nara/blob/main/utilities/encryptor.go#L77>)

```go
func (e *Encryptor) Open(nonce, ciphertext []byte) ([]byte, error)
```

Open decrypts ciphertext using XChaCha20\-Poly1305.

The nonce must be the same nonce used during encryption. Returns an error if the ciphertext is invalid or if it was encrypted with a different key.

<a name="Encryptor.Seal"></a>
### func \(\*Encryptor\) [Seal](<https://github.com/eljojo/nara/blob/main/utilities/encryptor.go#L55>)

```go
func (e *Encryptor) Seal(plaintext []byte) (nonce, ciphertext []byte, err error)
```

Seal encrypts plaintext using XChaCha20\-Poly1305 with a random nonce.

Returns the nonce and ciphertext separately so the nonce can be stored alongside the ciphertext. The nonce is 24 bytes, and the ciphertext includes a 16\-byte authentication tag.

<a name="Result"></a>
## type [Result](<https://github.com/eljojo/nara/blob/main/utilities/correlator.go#L40-L43>)

Result is returned by Send.

```go
type Result[Resp any] struct {
    Response Resp
    Err      error // ErrTimeout if no response in time
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
